meta:
  engine: 4.1.0

units:
  kx: cx
  ky: cy
  switch_hole: 14
  cap_x: 18
  cap_y: 18

  # PARAMETERS
  # 1. How thick you want the final case wall to be
  final_wall: 3
  # 2. How much "glue" to apply.
  # This needs to be big enough to bridge your largest gap.
  # (12mm expansion covers a 24mm gap)
  glue_size: 12

points:
  zones:
    # --- 1. LEFT MODIFIERS ---
    sidepad:
      anchor:
        shift: [100, -100]
      columns:
        outer:
          key.column_net: P1
        inner:
          key.column_net: P0
      rows:
        mod:
          row_net: P2
        bottom:
          row_net: P3
        home:
          row_net: P4
        top:
          row_net: P5
        num:
          row_net: P6

    # --- 2. MAIN ALPHA MATRIX ---
    matrix:
      anchor:
        ref: sidepad_inner_num
        shift: [1.3kx, -3.9ky]
      columns:
        pinky:
          key.stagger: 0
          key.column_net: P7
        ring:
          key.stagger: 0.25ky
          key.column_net: P8
        middle:
          key.stagger: -0.25ky
          key.column_net: P9
        index:
          key.stagger: 0ky
          key.column_net: P10
      rows:
        mod:
          row_net: P2
        bottom:
          row_net: P3
        home:
          row_net: P4
        top:
          row_net: P5
        num:
          row_net: P6

    # --- 3. NAV STRIP ---
    nav:
      anchor:
        ref: matrix_index_num
        shift: [1.5kx, -3ky]
      columns:
        col:
          key.column_net: P16
      rows:
        top:
          row_net: P5
        mid:
          row_net: P4
        bot:
          row_net: P3

    # --- 4. THUMB CLUSTER ---
    thumb:
      anchor:
        ref: matrix_middle_mod
        shift: [2.1kx, -1.2ky]
        rotate: -40
      columns:
        left:
          key.column_net: P14
        right:
          key.column_net: P15
      rows:
        upper:
          row_net: P18
        lower:
          shift: [0kx, 0.5ky]
          row_net: P19

outlines:
  # 1. RAW KEYS (Hidden)
  _raw:
    - what: rectangle
      where: true
      size: [kx, ky]

  # 2. THE GLUE (Hidden)
  # We take the keys and expand them massively (+12mm).
  # This merges everything into one giant blob and deletes all gaps.
  _glue:
    - what: outline
      name: _raw
      expand: glue_size

  # 3. THE BOARD (Visible)
  # Now we shrink the blob back down.
  # We subtract the glue_size but add back our desired wall thickness.
  # (12mm - 3mm = shrink by 9mm)
  board:
    - what: outline
      name: _glue
      expand: -(glue_size - final_wall)
      fillet: 2

  # 4. CUTOUTS & KEYCAPS
  _cutouts:
    - what: rectangle
      where: true
      size: [switch_hole, switch_hole]

  _keycaps:
    - what: rectangle
      where: true
      size: [cap_x, cap_y]
      fillet: 2

  # 5. PLATE
  plate:
    - what: outline
      name: board
    - what: outline
      name: _cutouts
      operation: subtract

  # 6. PREVIEW
  preview:
    - what: outline
      name: board
    - what: outline
      name: _keycaps
      operation: stack
    - what: outline
      name: _cutouts
      operation: stack

cases:
  bottom_case:
    - what: outline
      name: board
      extrude: 2

  switch_plate:
    - what: outline
      name: plate
      extrude: 1.5

pcbs:
  caldera_pcb:
    outlines:
      main:
        outline: board
    footprints:
      choc_hotswap:
        what: choc
        where: true
        params:
          keycaps: true
          reverse: true
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
      diode:
        what: diode
        where: true
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
        adjust:
          shift: [0, -5]
          rotate: 180
      nicenano:
        what: promicro
        where:
          ref: matrix_index_home
          shift: [1.1kx, 0.5ky]
          rotate: -90
        params:
          orientation: down
